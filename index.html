<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>(RE)FIND PAIR</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
html, body {
  margin:0; padding:0; height:100%; width:100vw; box-sizing:border-box;
  font-family:'Orbitron',Arial,sans-serif; overflow:hidden;
}
body {
  min-height:100vh; width:100vw;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  background:linear-gradient(135deg,#8e2de2 0%,#4a00e0 100%);
  position:relative;
}
.fly-text {
  position:fixed;
  font-family:'Orbitron',Arial,sans-serif; font-weight:700;
  color:rgba(255,255,255,0.15); font-size:2vw; pointer-events:none; white-space:nowrap;
  text-shadow:0 1px 7px #350e5f; z-index:1; user-select:none; transition:opacity 0.3s;
}
#startScreen {
  position:fixed; top:0; left:0; width:100vw; height:100vh; background:none;
  display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:99; pointer-events:auto;
}
#startScreen h1 {
  font-family:'Orbitron',Arial,sans-serif; font-size:5vw; color:#fff;
  font-weight:900; letter-spacing:0.13em; text-align:center; margin-bottom:3vw; margin-top:-7vw; user-select:none;
  text-shadow:0 2px 18px #3c0066;
}
#startScreen p {
  font-size:2.3vw; color:#f1defb; margin-bottom:4vw; font-family:'Orbitron', Arial, sans-serif; letter-spacing:0.04em;
  user-select:none; text-align:center;
}
.level-buttons {
  display: flex; gap: 2vw; flex-wrap: wrap; justify-content: center;
}
#startScreen button {
  padding:19px 64px; font-size:2vw; border-radius:34px; border:none;
  color:#fff; font-family:'Orbitron',Arial,sans-serif; font-weight:700;
  cursor:pointer; box-shadow:0 4px 22px rgba(46,37,94,0.23); transition: box-shadow 0.15s, background 0.15s;
  min-width: 180px;
}
#jmikeBtn {
  background:linear-gradient(90deg,#b621fe 0%,#1fd1f9 100%);
}
#denBtn {
  background:linear-gradient(90deg,#ff6b6b 0%,#ffa500 100%);
}
#tuongBtn {
  background:linear-gradient(90deg,#00c6ff 0%,#0072ff 100%);
}
#pixBtn {
  background:linear-gradient(90deg,#4ecdc4 0%,#44a08d 100%);
}
#startScreen button:hover {
  box-shadow:0 6px 30px rgba(46,37,94,0.4);
}
#jmikeBtn:hover { background:linear-gradient(90deg,#4a00e0 0%,#8e2de2 100%);}
#denBtn:hover { background:linear-gradient(90deg,#ff5252 0%,#ff9800 100%);}
#tuongBtn:hover { background:linear-gradient(90deg,#005bb5 0%,#003f7f 100%);}
#pixBtn:hover { background:linear-gradient(90deg,#26a69a 0%,#00796b 100%);}
.level-info {
  color:#d4b8ff; font-size:1.4vw; margin-top:2vw; max-width:90vw;
  font-family:'Orbitron',Arial,sans-serif; letter-spacing:0.02em;
  text-align:center; line-height:1.5; text-shadow:0 1px 8px #3c006688;
}
.level-info strong { color:#fff; }
#backToMenu {
  position:absolute; bottom:3vh; left:50%; transform:translateX(-50%);
  padding:12px 32px; font-size:1.6vw; border-radius:24px; border:2px solid #b621fe;
  background:rgba(182,33,254,0.15); color:#fff; font-family:'Orbitron',Arial,sans-serif;
  font-weight:600; cursor:pointer; transition:all 0.2s;
  box-shadow:0 2px 12px rgba(182,33,254,0.3);
}
#backToMenu:hover {
  background:linear-gradient(90deg,#b621fe 0%,#1fd1f9 100%);
  box-shadow:0 4px 20px rgba(182,33,254,0.5); transform:translateX(-50%) translateY(-2px);
}
@media (max-width:600px) {
  #levelInfo { font-size:18px;}
  .card { width:24vw; height:24vw; min-width:62px; min-height:62px;}
  .level-buttons { flex-direction: column; gap: 1.5vh; }
  #startScreen button { font-size: 5.5vw; padding: 4vw 8vw; min-width: 70vw; }
  .level-info { font-size:3.5vw; margin-top:3vh; padding:0 5vw; }
  #backToMenu { font-size:4vw; padding:3vw 6vw; bottom:2vh; }
}
#overlay {
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(24,10,44,0.82); color:#fff; font-size:2.6vw;
  font-family:'Orbitron',Arial,sans-serif; letter-spacing:0.06em;
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  z-index:98; transition:opacity 0.5s; pointer-events:none; opacity:0;
}
#overlay.visible { pointer-events:all; opacity:1;}
#overlay .big-button {
  padding:20px 66px; font-size:2.2vw; border-radius:33px; border:none;
  background:linear-gradient(90deg,#b621fe 0%,#1fd1f9 100%);
  color:#fff; margin-top:48px; font-family:'Orbitron',Arial,sans-serif; font-weight:700;
  cursor:pointer; box-shadow:0 4px 38px rgba(46,37,94,0.30);
  transition:box-shadow 0.15s, background 0.15s;
}
#overlay .big-button:hover { background:linear-gradient(90deg,#4a00e0 0%,#8e2de2 100%);}
#gameRoot {
  width:100vw; height:97vh; display:flex; flex-direction:column;
  justify-content:center; align-items:center; position:relative;
}
#levelInfo {
  color:#f1defb; font-size:2.2vw; margin-bottom:26px; font-family:'Orbitron',Arial,sans-serif;
  text-shadow:0 2px 18px #3c0066; letter-spacing:0.08em;
}
#pairsGrid {
  display:grid; justify-content:center; align-content:center; gap:2vw;
}
.card {
  width:13vw; height:13vw; max-width:170px; max-height:170px; min-width:92px; min-height:92px; position:relative;
  background:linear-gradient(133deg,#4a00e0 60%,#8e2de2 100%);
  border-radius:18px; box-shadow:0 4px 28px #22016b88;
  cursor:pointer; user-select:none; border:2px solid #ceb2fd; display:flex;
  align-items:center; justify-content:center; transition:transform 0.14s;
}
.card.open, .card.matched { cursor:default;}
.card.open, .card.matched {
  background:linear-gradient(120deg,#24284c,#8e2de2 99%);
  box-shadow:0 4px 52px #22016b99;
}
.card img {
  width:82%; height:82%; object-fit:contain; pointer-events:none; user-select:none;
}
</style>
</head>
<body>
<div id="startScreen">
  <h1>(RE)FIND PAIR</h1>
  <p>Choose your level and find all pairs!</p>
  <div class="level-buttons">
    <button id="jmikeBtn">j.mike level</button>
    <button id="denBtn">den level</button>
    <button id="tuongBtn">tuong level</button>
    <button id="pixBtn">pix level</button>
  </div>
  <div class="level-info">
    <strong>j.mike level:</strong> 4 levels (4, 5, 5, 7 pairs)<br>
    <strong>den level:</strong> 4 levels (4, 5, 5, 7 pairs)<br>
    <strong>tuong level:</strong> 4 levels (4, 5, 5, 7 pairs)<br>
    <strong>pix level:</strong> 14 levels (7x13, 9 pairs)
  </div>
</div>
<div id="overlay"></div>
<div id="gameRoot" style="display:none;">
  <div id="levelInfo"></div>
  <div id="pairsGrid"></div>
  <button id="backToMenu">Back to Menu</button>
</div>
<script>
const FLYWORD = 'memory';
const FLY_COUNT = 26, MIN_DUR = 8, MAX_DUR = 22;
function makeFlyText() {
  const el = document.createElement('div');
  el.className = 'fly-text';
  el.textContent = FLYWORD;
  el.style.left = (Math.random() * 97) + 'vw';
  el.style.top = '-7vh';
  el.style.fontSize = (1.8 + Math.random()*1.8) + 'vw';
  el.style.opacity = String(0.09 + Math.random()*0.12);
  document.body.appendChild(el);
  const duration = MIN_DUR + Math.random() * (MAX_DUR - MIN_DUR);
  const start = Date.now();
  function animate() {
    const progress = Math.min(1, (Date.now() - start) / (duration * 1000));
    el.style.top = (-7 + progress * 112) + 'vh';
    if(progress<1) requestAnimationFrame(animate);
    else { el.remove(); makeFlyText(); }
  }
  setTimeout(()=>animate(), Math.random()*1700);
}
for(let i=0;i<FLY_COUNT;i++) makeFlyText();

const startScreen = document.getElementById('startScreen');
const jmikeBtn = document.getElementById('jmikeBtn');
const denBtn = document.getElementById('denBtn');
const tuongBtn = document.getElementById('tuongBtn');
const pixBtn = document.getElementById('pixBtn');
const overlay = document.getElementById('overlay');
const levelInfo = document.getElementById('levelInfo');
const pairsGrid = document.getElementById('pairsGrid');
const gameRoot = document.getElementById('gameRoot');
const backToMenu = document.getElementById('backToMenu');

const JMIKE_IMAGES = Array.from({length:23},(_,i)=>`${i+1}.png`);
const jMikeImgs = JMIKE_IMAGES.map(src => { let img = new Image(); img.src = src; return img; });

const DEN_IMAGES = Array.from({length:21},(_,i)=>`den${i+1}.png`);
const denImgs = DEN_IMAGES.map(src => { let img = new Image(); img.src = src; return img; });

const TUONG_IMAGES = Array.from({length:23},(_,i)=>`tuong${i+1}.png`);
const tuongImgs = TUONG_IMAGES.map(src => { let img = new Image(); img.src = src; return img; });


const PIX_IMAGES = Array.from({length:99},(_,i)=>`pix${i+1}.png`);
const pixImgs = PIX_IMAGES.map(src => { let img = new Image(); img.src = src; return img; });

const JMIKE_LEVELS = [
  { nPairs:4, imgFrom:19, imgTo:22 },
  { nPairs:5, imgFrom:0, imgTo:4 },   
  { nPairs:5, imgFrom:5, imgTo:9 },   
  { nPairs:7, imgFrom:10, imgTo:20 }
];

const DEN_LEVELS = [
  { nPairs:4, imgFrom:0, imgTo:3 },
  { nPairs:5, imgFrom:4, imgTo:8 },
  { nPairs:5, imgFrom:9, imgTo:13 },
  { nPairs:7, imgFrom:14, imgTo:20 }
];

const TUONG_LEVELS = [
  { nPairs:4, imgFrom:19, imgTo:22 },
  { nPairs:5, imgFrom:0, imgTo:4 },
  { nPairs:5, imgFrom:5, imgTo:9 },
  { nPairs:7, imgFrom:10, imgTo:20 }
];

const PIX_LEVELS = [
  { nPairs:7, imgFrom:0, imgTo:6 },
  { nPairs:7, imgFrom:7, imgTo:13 },
  { nPairs:7, imgFrom:14, imgTo:20 },
  { nPairs:7, imgFrom:21, imgTo:27 },
  { nPairs:7, imgFrom:28, imgTo:34 },
  { nPairs:7, imgFrom:35, imgTo:41 },
  { nPairs:7, imgFrom:42, imgTo:48 },
  { nPairs:7, imgFrom:49, imgTo:55 },
  { nPairs:7, imgFrom:56, imgTo:62 },
  { nPairs:7, imgFrom:63, imgTo:69 },
  { nPairs:7, imgFrom:70, imgTo:76 },
  { nPairs:7, imgFrom:77, imgTo:83 },
  { nPairs:7, imgFrom:84, imgTo:90 },
  { nPairs:9, imgFrom:91, imgTo:98 }
];

let cards = [], opened = [], matched = [], level = 0, currentGameType = null, currentImages = [], currentLevels = [];

function showOverlay(text, btn, isShare) {
  const btnHtml = btn ? `<button class="big-button">${btn}</button>` : '';
  overlay.innerHTML = `<span>${text}</span>${btnHtml}`;
  overlay.classList.add('visible');

  if(isShare) {
    setTimeout(() => {
      const shareBtn = overlay.querySelector('.big-button');
      if (shareBtn) {
        shareBtn.onclick = function() {
          const tweet = encodeURIComponent(`Completed ${currentGameType} level in Memory Game!`);
          window.open("https://twitter.com/intent/tweet?text=" + tweet, "_blank");
        };
      }
    }, 50);
  }
}

function hideOverlay() { 
  overlay.classList.remove('visible'); 
  overlay.innerHTML=''; 
}

function showStartScreen() {
  gameRoot.style.display = 'none';
  pairsGrid.innerHTML = '';
  startScreen.style.display = 'flex';
  hideOverlay();
}

function setupLevel(lvlIdx, gameType, images, levels) {
  opened = []; matched = [];
  pairsGrid.innerHTML = '';
  levelInfo.textContent = `${gameType} Level ${lvlIdx}`;
  level = lvlIdx;
  currentGameType = gameType;
  currentImages = images;
  currentLevels = levels;
  
  const levelData = levels[lvlIdx];
  const imgIndexes = [];
  for(let i=levelData.imgFrom; i<=levelData.imgTo; i++) imgIndexes.push(i);
  
  let pairsArr = [...imgIndexes, ...imgIndexes];
  for(let i=pairsArr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1)); 
    [pairsArr[i],pairsArr[j]]=[pairsArr[j],pairsArr[i]];
  }
  
  cards = pairsArr.map((idx,i)=>({id:i,imgIdx:idx,open:false,matched:false,element:null}));
  let cols = Math.min(8,Math.ceil(cards.length/2)), rows = Math.ceil(cards.length/cols);
  pairsGrid.style.gridTemplateColumns = `repeat(${cols},1fr)`;
  pairsGrid.style.gridTemplateRows = `repeat(${rows},1fr)`;
  
  cards.forEach((card,ci)=>{
    let cardDiv=document.createElement('div');
    cardDiv.className = "card";
    cardDiv.dataset.index = ci;
    cardDiv.onclick = ()=>openCard(ci);
    card.element = cardDiv;
    pairsGrid.appendChild(cardDiv);
    renderCard(ci);
  });
  gameRoot.style.display = 'flex';
}

function renderCard(ci){
  let card = cards[ci], el = card.element;
  el.classList.remove('open'); el.classList.remove('matched');
  if(card.matched) el.classList.add('matched');
  else if(card.open) el.classList.add('open');
  else el.innerHTML='';
  
  if(card.open||card.matched){
    let img = currentImages[card.imgIdx];
    if(img.complete && img.naturalWidth > 0){el.innerHTML='';el.appendChild(img.cloneNode());}
    else{el.textContent="?";}
  }
}

function openCard(idx){
  let card = cards[idx];
  if(card.open || card.matched || opened.length >= 2) return;
  card.open = true; renderCard(idx); opened.push(idx);
  
  if(opened.length === 2){
    let a = cards[opened[0]], b = cards[opened[1]];
    if(a.imgIdx === b.imgIdx){
      setTimeout(()=>{
        a.matched = b.matched = true;
        renderCard(opened[0]); renderCard(opened[1]); opened=[];
        checkWinLevel();
      },420);
    }else{
      setTimeout(()=>{
        a.open = b.open = false;
        renderCard(opened[0]); renderCard(opened[1]); opened=[];
      },900);
    }
  }
}

function checkWinLevel(){
  if(cards.every(card=>card.matched)){
    if(level < currentLevels.length-1) {
      showOverlay(`Level ${level} complete!`, 'Next Level');
    } else {
      showOverlay('Congratulations! All levels complete!', 'Share', true);
    }
  }
}

backToMenu.onclick = showStartScreen;

jmikeBtn.onclick = function() {
  startScreen.style.display = 'none';
  setupLevel(0, 'j.mike', jMikeImgs, JMIKE_LEVELS);
};

denBtn.onclick = function() {
  startScreen.style.display = 'none';
  setupLevel(0, 'den', denImgs, DEN_LEVELS);
};

tuongBtn.onclick = function() {
  startScreen.style.display = 'none';
  setupLevel(0, 'tuong', tuongImgs, TUONG_LEVELS);
};

pixBtn.onclick = function() {
  startScreen.style.display = 'none';
  setupLevel(0, 'pix', pixImgs, PIX_LEVELS);
};

overlay.onclick = e => {
  if(e.target.tagName === 'BUTTON' && e.target.classList.contains('big-button')) {
    if(e.target.textContent === 'Next Level') {
      hideOverlay();
      if(level < currentLevels.length-1) {
        setupLevel(level+1, currentGameType, currentImages, currentLevels);
      }
    } else if(e.target.textContent === 'Share') {
      hideOverlay();
    }
  }
};

window.addEventListener('resize', ()=>{ pairsGrid.style.height=''; pairsGrid.style.width='';});
</script>
</body>
</html>
