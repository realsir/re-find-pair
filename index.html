<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>(RE)FIND PAIR</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
html, body {
  margin:0; padding:0; height:100%; width:100vw; box-sizing:border-box;
  font-family:'Orbitron',Arial,sans-serif; overflow:hidden;
}
body {
  min-height:100vh; width:100vw;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  background:linear-gradient(135deg,#8e2de2 0%,#4a00e0 100%);
  position:relative;
}
.fly-text {
  position:fixed;
  font-family:'Orbitron',Arial,sans-serif; font-weight:700;
  color:rgba(255,255,255,0.15); font-size:2vw; pointer-events:none; white-space:nowrap;
  text-shadow:0 1px 7px #350e5f; z-index:1; user-select:none; transition:opacity 0.3s;
}
#startScreen {
  position:fixed; top:0; left:0; width:100vw; height:100vh; background:none;
  display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:99; pointer-events:auto;
}
#startScreen h1 {
  font-family:'Orbitron',Arial,sans-serif; font-size:5vw; color:#fff;
  font-weight:900; letter-spacing:0.13em; text-align:center; margin-bottom:3vw; margin-top:-7vw; user-select:none;
  text-shadow:0 2px 18px #3c0066;
}
#startScreen p {
  font-size:2.3vw; color:#f1defb; margin-bottom:4vw; font-family:'Orbitron', Arial, sans-serif; letter-spacing:0.04em;
  user-select:none; text-align:center;
}
#startScreen button {
  padding:19px 64px; font-size:2vw; border-radius:34px; border:none;
  background:linear-gradient(90deg,#b621fe 0%,#1fd1f9 100%);
  color:#fff; font-family:'Orbitron',Arial,sans-serif; font-weight:700;
  cursor:pointer; box-shadow:0 4px 22px rgba(46,37,94,0.23); transition: box-shadow 0.15s, background 0.15s;
}
#startScreen button:hover { background:linear-gradient(90deg,#4a00e0 0%,#8e2de2 100%);}
#overlay {
  position:fixed; top:0; left:0; width:100vw; height:100vh;
  background:rgba(24,10,44,0.82); color:#fff; font-size:2.6vw;
  font-family:'Orbitron',Arial,sans-serif; letter-spacing:0.06em;
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  z-index:98; transition:opacity 0.5s; pointer-events:none; opacity:0;
}
#overlay.visible { pointer-events:all; opacity:1;}
#overlay .big-button {
  padding:20px 66px; font-size:2.2vw; border-radius:33px; border:none;
  background:linear-gradient(90deg,#b621fe 0%,#1fd1f9 100%);
  color:#fff; margin-top:48px; font-family:'Orbitron',Arial,sans-serif; font-weight:700;
  cursor:pointer; box-shadow:0 4px 38px rgba(46,37,94,0.30);
  transition:box-shadow 0.15s, background 0.15s;
}
#overlay .big-button:hover { background:linear-gradient(90deg,#4a00e0 0%,#8e2de2 100%);}
#gameRoot {
  width:100vw; height:97vh; display:flex; flex-direction:column;
  justify-content:center; align-items:center; position:relative;
}
#levelInfo {
  color:#f1defb; font-size:2.2vw; margin-bottom:26px; font-family:'Orbitron',Arial,sans-serif;
  text-shadow:0 2px 18px #3c0066; letter-spacing:0.08em;
}
#pairsGrid {
  display:grid; justify-content:center; align-content:center; gap:2vw;
}
.card {
  width:13vw; height:13vw; max-width:170px; max-height:170px; min-width:92px; min-height:92px; position:relative;
  background:linear-gradient(133deg,#4a00e0 60%,#8e2de2 100%);
  border-radius:18px; box-shadow:0 4px 28px #22016b88;
  cursor:pointer; user-select:none; border:2px solid #ceb2fd; display:flex;
  align-items:center; justify-content:center; transition:transform 0.14s;
}
.card.open, .card.matched { cursor:default;}
.card.open, .card.matched {
  background:linear-gradient(120deg,#24284c,#8e2de2 99%);
  box-shadow:0 4px 52px #22016b99;
}
.card img {
  width:82%; height:82%; object-fit:contain; pointer-events:none; user-select:none;
}
@media (max-width:600px) {
  #levelInfo { font-size:18px;}
  .card { width:24vw; height:24vw; min-width:62px; min-height:62px;}
}
</style>
</head>
<body>
<div id="startScreen">
  <h1>(RE)FIND PAIR</h1>
  <p>Try to find all pairs.</p>
  <button id="startBtn">(re)start</button>
</div>
<div id="overlay"></div>
<div id="gameRoot" style="display:none;">
  <div id="levelInfo"></div>
  <div id="pairsGrid"></div>
</div>
<script>
const FLYWORD = '(re)dacted';
const FLY_COUNT = 26, MIN_DUR = 8, MAX_DUR = 22;
function makeFlyText() {
  const el = document.createElement('div');
  el.className = 'fly-text';
  el.textContent = FLYWORD;
  el.style.left = (Math.random() * 97) + 'vw';
  el.style.top = '-7vh';
  el.style.fontSize = (1.8 + Math.random()*1.8) + 'vw';
  el.style.opacity = String(0.09 + Math.random()*0.12);
  document.body.appendChild(el);
  const duration = MIN_DUR + Math.random() * (MAX_DUR - MIN_DUR);
  const start = Date.now();
  function animate() {
    const progress = Math.min(1, (Date.now() - start) / (duration * 1000));
    el.style.top = (-7 + progress * 112) + 'vh';
    if(progress<1) requestAnimationFrame(animate);
    else { el.remove(); makeFlyText(); }
  }
  setTimeout(()=>animate(), Math.random()*1700);
}
for(let i=0;i<FLY_COUNT;i++) makeFlyText();

const startScreen = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');
const overlay = document.getElementById('overlay');
const levelInfo = document.getElementById('levelInfo');
const pairsGrid = document.getElementById('pairsGrid');
const gameRoot = document.getElementById('gameRoot');

// --- загрузка всех используемых картинок ---
const ALL_IMAGE_SOURCES = [
  // Main game images (1–17.png)
  ...Array.from({length:17},(_,i)=>`${i+1}.png`),
  // Level 0 images for pairs (20–23.png)
  "20.png","21.png","22.png","23.png"
];
const cardImgs = [];
ALL_IMAGE_SOURCES.forEach(src => {
  let img = new Image(); img.src = src; cardImgs.push(img);
});

// --- Levels array, Level 0 first! ---
const LEVELS = [
  // Level 0: uses separate images
  { nPairs:4, imgFrom:17, imgTo:20 }, // в cardImgs индексы 17–20 = 20,21,22,23.png
  { nPairs:5, imgFrom:0, imgTo:4 },   // 1–5.png
  { nPairs:5, imgFrom:5, imgTo:9 },   // 6–10.png
  { nPairs:7, imgFrom:10, imgTo:16 }  // 11–17.png
];
let cards = [], opened = [], matched = [], level = 0;

function showOverlay(text, btn, isShare) {
  const btnHtml = btn ? `<button class="big-button">${btn}</button>` : '';
  overlay.innerHTML = `<span>${text}</span>${btnHtml}`;
  overlay.classList.add('visible');

  if(isShare) {
    setTimeout(() => {
      const shareBtn = overlay.querySelector('.big-button');
      if (shareBtn) {
        shareBtn.onclick = function() {
          const tweet = encodeURIComponent("Congratulations, you've found all the pairs in the \"(re)find pair\" game.\n\nTry to find them all: re-find-pair.vercel.app");
          window.open("https://twitter.com/intent/tweet?text=" + tweet, "_blank");
        };
      }
    }, 50);
  }
}

function hideOverlay() { overlay.classList.remove('visible'); overlay.innerHTML=''; }

function setupLevel(lvlIdx){
  opened = []; matched = [];
  pairsGrid.innerHTML = '';
  levelInfo.textContent = `Level ${lvlIdx}`;
  level = lvlIdx;
  const imgIndexes = [];
  for(let i=LEVELS[lvlIdx].imgFrom; i<=LEVELS[lvlIdx].imgTo; i++) imgIndexes.push(i);
  let pairsArr = [...imgIndexes, ...imgIndexes];
  for(let i=pairsArr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [pairsArr[i],pairsArr[j]]=[pairsArr[j],pairsArr[i]];}
  cards = pairsArr.map((idx,i)=>({id:i,imgIdx:idx,open:false,matched:false,element:null}));
  let cols = Math.min(6,Math.ceil(cards.length/2)), rows = Math.ceil(cards.length/cols);
  pairsGrid.style.gridTemplateColumns = `repeat(${cols},1fr)`;
  pairsGrid.style.gridTemplateRows = `repeat(${rows},1fr)`;
  cards.forEach((card,ci)=>{
    let cardDiv=document.createElement('div');
    cardDiv.className = "card";
    cardDiv.dataset.index = ci;
    cardDiv.onclick = ()=>openCard(ci);
    card.element = cardDiv;
    pairsGrid.appendChild(cardDiv);
    renderCard(ci);
  });
  gameRoot.style.display = 'flex';
}
function renderCard(ci){
  let card = cards[ci], el = card.element;
  el.classList.remove('open'); el.classList.remove('matched');
  if(card.matched) el.classList.add('matched');
  else if(card.open) el.classList.add('open');
  else el.innerHTML='';
  if(card.open||card.matched){
    let img = cardImgs[card.imgIdx];
    if(img.complete){el.innerHTML='';el.appendChild(img.cloneNode());}
    else{el.textContent="?";}
  }
}
function openCard(idx){
  let card = cards[idx];
  if(card.open || card.matched || opened.length >= 2) return;
  card.open = true; renderCard(idx); opened.push(idx);
  if(opened.length === 2){
    let a = cards[opened[0]], b = cards[opened[1]];
    if(a.imgIdx === b.imgIdx){
      setTimeout(()=>{
        a.matched = b.matched = true;
        renderCard(opened[0]); renderCard(opened[1]); opened=[];
        checkWinLevel();
      },420);
    }else{
      setTimeout(()=>{
        a.open = b.open = false;
        renderCard(opened[0]); renderCard(opened[1]); opened=[];
      },900);
    }
  }
}
function checkWinLevel(){
  if(cards.every(card=>card.matched)){
    if(level<LEVELS.length-1)
      showOverlay(`Level ${level} complete!`,'Next Level');
    else {
      showOverlay('Congratulations! All levels complete!','Sha(re)',true);
    }
  }
}

startBtn.onclick = function() {
  startScreen.style.display='none';
  setupLevel(0);
};
overlay.onclick = e => {
  if(e.target.tagName === 'BUTTON' && e.target.classList.contains('big-button')
     && e.target.textContent === 'Next Level'){
    hideOverlay();
    if(level < LEVELS.length-1){
      setupLevel(level+1);
    }
  }
};
window.addEventListener('resize', ()=>{ pairsGrid.style.height=''; pairsGrid.style.width='';});
</script>
</body>
</html>
